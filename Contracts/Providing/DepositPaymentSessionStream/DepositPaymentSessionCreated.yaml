asyncapi: 2.0.0
info:
  title: Payment Gateway Service
  version: v0.1.0
  description: |
    A CQRS/ES microservice which provides an API for creating payment sessions at Allmyhomes.
    The API is currently not consumed by any context, but acts as an protoype for being used in the agent reservation flow.

defaultContentType: application/json

channels:
  payment_gateway-deposit_payment_session-stream:
    description: A stream which publishes Deposit Payment Session events.
    subscribe:
      summary: Receive information about the Deposit Payment Session process for a deposit payment of a reservation.
      message:
        oneOf:
          - $ref: '#/components/messages/DepositPaymentSessionCreated'

components:
  messages:
    DepositPaymentSessionCreated:
      name: "PaymentGateway.DepositPaymentSessionCreated"
      title: Deposit Payment Session Created
      summary: Deposit Payment Session created for deposit payment
      contentType: application/json
      payload:
        $ref: "#/components/schemas/DepositPaymentSessionPayload"

  schemas:
    Uuid:
      type: string
      format: uuid
    DepositPaymentSessionPayload:
      type: object
      required:
        - reservation_id
        - agent_id
        - checkout_session_d
        - project_id
        - prospect_id
        - unit_ids
        - total_unit_deposit
        - language
        - currency
        - payment_intent_id
        - payment_status
        - checkout_session_status
        - checkout_session_url
        - expires_at
        - occurred_at
        - created_at
      additionalProperties: false
      properties:
        reservation_id:
          description: reservation id (reservation purpose id)
          type: string
          pattern: ^\d{4}-\d{4}-\d{5}$
          example: 1234-1234-12345
        checkout_session_d:
          description: checkout session id generated by stripe
          type: string
        agent_id:
          $ref: "#/components/schemas/Uuid"
        project_id:
          type: integer
          format: int10
        prospect_id:
          $ref: "#/components/schemas/Uuid"
        unit_ids:
          type: array
          items:
            type: integer
            format: int10
        total_unit_deposit:
          type: integer
          format: float
        language:
          type: string
        currency:
          type: string
        customer_id:
          description: (potential) customer id generated by stripe. Can be used to get customer details from Stripe
          type: string
        payment_intent_id:
          description: payment intent id generated by stripe. Can be used to get payment details from Stripe
          type: string
        payment_status:
          description: payment status of the transaction of the checkout session of Stripe
          type: string
          enum:
            - unpaid
            - paid
        checkout_session_status:
          description: status of the checkout session of Stripe
          type: string
          enum:
            - open
            - complete
            - expired
        checkout_session_url:
          description: url of the hosted checkout session page by Stripe
          type: string
        expires_at:
          description: expiration date of checkout session respectively the checkout session url
          type: string
          format: date-time
        occurred_at:
          type: string
          format: date-time
        created_at:
          type: string
          format: date-time
      example:
        reservation_id: "1234-1234-12345"
        checkout_session_d: "cs_test_a10MHweko6m628yFFNm7lQQscNp9f9qs2JL7Hzdfz3JdReLBg82UNMmrLo"
        agent_id: "b72a7cdc-0d36-411e-b897-c9dd0a79c318"
        project_id: 80332
        prospect_id: "26cb4a66-bc80-4bba-b4e3-bbef4f8221c2"
        unit_ids: [ 5741 ]
        total_unit_deposit: 17500
        language: "en"
        currency: "eur"
        customer_id: "customer id"
        payment_intent_id: "pi_3KUCk3JHRV8spf0Q1Z0ulJ2S"
        payment_status: "unpaid"
        checkout_session_status: "open"
        checkout_session_url: "https://checkout.stripe.com/pay/cs_test_a10MHweko6m628yFFNm7lQQscNp9f9qs2JL7Hzdfz3JdReLBg82UNMmrLo#fidkdWxOYHwnPyd1blpxYHZxWjA0TjE0PW1PTVdTPXZ1YzVUbTJra21hZGNvQTVfXDE1SHxUVDNdcmRLNmg0UFNyMDZnMWYyam5UdzxQYEtJNH1wNmJndU58NWlRMT1GQk5gYmRyalJHNXdKNTVCX1xSfFZOcScpJ2N3amhWYHdzYHcnP3F3cGApJ2lkfGpwcVF8dWAnPyd2bGtiaWBabHFgaCcpJ2BrZGdpYFVpZGZgbWppYWB3dic%2FcXdwYCkndXdgaWpkYUNqa3EnPydXamdqcWoneCUl"
        expires_at: "2074-04-07 10:11:01"
        occurred_at: "2022-02-17 16:22:05"
        created_at: "2022-02-17 16:22:05"
